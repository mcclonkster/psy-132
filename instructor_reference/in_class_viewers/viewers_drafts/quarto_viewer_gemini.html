<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quarto Portable Slide Viewer</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM CDNs -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX parsing in browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=JetBrains+Mono&display=swap');
        
        body { font-family: 'Inter', sans-serif; background-color: #eceff4; color: #2e3440; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Slide styling variables */
        :root {
            --nord-0: #2e3440;
            --nord-4: #eceff4;
            --nord-frost: #81a1c1;
        }
        
        pre { white-space: pre-wrap; word-break: break-all; }
        table { width: 100%; border-collapse: collapse; margin: 1.5rem 0; }
        
        /* Card-specific depth effects */
        .slide-card-shadow {
            box-shadow: 0 10px 30px -10px rgba(46, 52, 64, 0.1), 
                        0 20px 60px -15px rgba(46, 52, 64, 0.15);
        }
        
        .slide-card-shadow:hover {
            box-shadow: 0 15px 40px -10px rgba(46, 52, 64, 0.12), 
                        0 30px 80px -20px rgba(46, 52, 64, 0.2);
        }

        .fade-in { animation: fadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef, memo } = React;

        // --- ICON HELPER ---
        const Icon = ({ name, size = 18, className = "" }) => {
            useEffect(() => {
                if (window.lucide) window.lucide.createIcons();
            }, [name]);
            return <i data-lucide={name} style={{ width: size, height: size }} className={className}></i>;
        };

        // --- INLINE PARSER ---
        const SafeInlineContent = ({ text }) => {
            if (!text) return null;
            const tokens = text.split(/(\*\*\*.*?\*\*\*|\*\*.*?\*\*|__.*?__|\[.*?\]\(.*?\)|`.*?`|\*.*?\*|_.*?_)/g);
            return (
                <span>
                    {tokens.map((token, i) => {
                        if (!token) return null;
                        if (token.startsWith('***') && token.endsWith('***')) return <strong key={i}><em>{token.slice(3, -3)}</em></strong>;
                        if ((token.startsWith('**') && token.endsWith('**')) || (token.startsWith('__') && token.endsWith('__'))) return <strong key={i}>{token.slice(2, -2)}</strong>;
                        if ((token.startsWith('*') && token.endsWith('*')) || (token.startsWith('_') && token.endsWith('_'))) return <em key={i}>{token.slice(1, -1)}</em>;
                        if (token.startsWith('`') && token.endsWith('`')) return <code key={i} className="bg-[#eceff4] px-1.5 py-0.5 rounded font-mono text-[0.85em] text-[#bf616a]">{token.slice(1, -1)}</code>;
                        const linkMatch = token.match(/^\[(.*?)\]\((.*?)\)$/);
                        if (linkMatch) return <a key={i} href={linkMatch[2]} target="_blank" rel="noopener noreferrer" className="text-[#81a1c1] underline hover:text-[#5e81ac] transition-colors">{linkMatch[1]}</a>;
                        return token;
                    })}
                </span>
            );
        };

        // --- MULTIMEDIA ---
        const SmartVideoPlayer = ({ url, alt, mini }) => {
            const [isPlaying, setIsPlaying] = useState(false);
            const getYouTubeId = (u) => {
                const m = u.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/);
                return (m && m[2].length === 11) ? m[2] : null;
            };
            const ytId = getYouTubeId(url);
            const watchUrl = ytId ? `https://www.youtube.com/watch?v=${ytId}` : url;

            if (mini) return <div className="flex items-center justify-center h-full w-full bg-[#3b4252] text-[#88c0d0]"><Icon name="video" /></div>;

            if (!isPlaying) {
                return (
                    <div className="relative w-full h-full group/player overflow-hidden rounded-2xl shadow-lg border border-[#d8dee9] bg-[#2e3440]">
                        <img 
                            src={ytId ? `https://img.youtube.com/vi/${ytId}/maxresdefault.jpg` : 'https://placehold.co/1280x720/3b4252/88c0d0?text=Video+Ready'} 
                            className="absolute inset-0 w-full h-full object-cover opacity-50 group-hover/player:opacity-70 transition-all duration-700" 
                        />
                        <div className="absolute inset-0 flex flex-col items-center justify-center space-y-6 z-10 p-4">
                            <button onClick={() => setIsPlaying(true)} className="flex items-center gap-3 px-8 py-4 bg-[#81a1c1] text-white rounded-full shadow-2xl transform hover:scale-105 transition-all duration-300 font-bold">
                                <Icon name="play" size={24} />
                                <span>Initialize Player</span>
                            </button>
                            <a href={watchUrl} target="_blank" className="flex items-center gap-2 px-4 py-2 bg-[#4c566a]/80 backdrop-blur-md text-[#eceff4] rounded-lg transition-all text-xs font-semibold border border-white/10 hover:bg-[#4c566a]">
                                <Icon name="external-link" size={14}/> 
                                <span>Open Video Link</span>
                            </a>
                        </div>
                    </div>
                );
            }
            return (
                <div className="w-full h-full relative rounded-2xl bg-black overflow-hidden shadow-2xl animate-in zoom-in-95 duration-300">
                    <iframe src={ytId ? `https://www.youtube.com/embed/${ytId}?autoplay=1` : url} className="absolute inset-0 w-full h-full border-0" allow="autoplay; fullscreen" />
                    <button onClick={() => setIsPlaying(false)} className="absolute top-4 right-4 p-2 bg-black/50 text-white rounded-full hover:bg-black/80 transition-colors"><Icon name="x" size={16}/></button>
                </div>
            );
        };

        // --- RENDERER ---
        const SlideRenderer = memo(({ content, isTitleSlide, isFullscreen, mini = false }) => {
            const blocks = useMemo(() => {
                const stripped = content.replace(/::: notes\s*([\s\S]*?)\s*:::/, '').trim();
                const lines = stripped.split('\n');
                const result = [];
                let currentBlock = null;

                lines.forEach((line) => {
                    const trimmed = line.trim();
                    const mediaMatch = trimmed.match(/^!\[(.*?)\]\((.*?)\)$/);
                    if (mediaMatch) {
                        currentBlock = null;
                        const isVideo = mediaMatch[1].toLowerCase() === 'video' || mediaMatch[2].includes('youtube') || mediaMatch[2].includes('vimeo') || mediaMatch[2].endsWith('.mp4');
                        result.push({ type: isVideo ? 'video' : 'image', alt: mediaMatch[1], url: mediaMatch[2] });
                        return;
                    }
                    if (trimmed.includes('|')) {
                        if (!currentBlock || currentBlock.type !== 'table') { 
                            currentBlock = { type: 'table', rows: [], alignments: [] }; 
                            result.push(currentBlock); 
                        }
                        if (trimmed.match(/^[|\s-:]+$/)) {
                            currentBlock.alignments = trimmed.split('|').filter(c => c.trim()).map(c => {
                                if (c.includes(':') && c.startsWith(':') && c.endsWith(':')) return 'center';
                                if (c.endsWith(':')) return 'right';
                                return 'left';
                            });
                            return;
                        }
                        const cells = trimmed.split('|').map(c => c.trim()).filter((c, i, a) => !(i === 0 && !c) && !(i === a.length - 1 && !c));
                        currentBlock.rows.push(cells);
                        return;
                    }
                    if (line.startsWith('```')) {
                        if (!currentBlock || currentBlock.type !== 'code') { currentBlock = { type: 'code', lines: [] }; result.push(currentBlock); }
                        else currentBlock = null;
                        return;
                    }
                    if (currentBlock && currentBlock.type === 'code') { currentBlock.lines.push(line); return; }
                    currentBlock = null;
                    if (line.startsWith('# ')) result.push({ type: 'h1', text: line.replace('# ', '') });
                    else if (line.startsWith('## ')) result.push({ type: 'h2', text: line.replace('## ', '') });
                    else if (line.startsWith('- ') || line.startsWith('* ')) result.push({ type: 'li', text: line.substring(2) });
                    else if (line.startsWith('> ')) result.push({ type: 'quote', text: line.replace('> ', '') });
                    else if (trimmed === '') result.push({ type: 'spacer' });
                    else result.push({ type: 'p', text: line });
                });
                return result;
            }, [content]);

            const textScale = mini ? 'text-[6px]' : (isFullscreen ? 'text-3xl' : 'text-2xl');
            const h1Scale = mini ? 'text-[10px]' : (isFullscreen ? 'text-7xl' : 'text-5xl');

            return (
                <div className={`w-full h-full flex flex-col fade-in ${isTitleSlide ? 'justify-center items-center text-center' : 'justify-start p-8 md:p-16'}`}>
                    {blocks.map((b, i) => {
                        if (b.type === 'h1') return <h1 key={i} className={`${h1Scale} font-black mb-8 text-[#2e3440] tracking-tighter`}><SafeInlineContent text={b.text} /></h1>;
                        if (b.type === 'h2') return <h2 key={i} className={`${mini ? 'text-[8px]' : 'text-4xl'} font-bold mb-8 text-[#3b4252] border-b-2 border-[#eceff4] pb-4 inline-block self-start`}><SafeInlineContent text={b.text} /></h2>;
                        if (b.type === 'li') return <li key={i} className={`${textScale} mb-4 ml-8 list-disc text-[#4c566a] pl-2 leading-relaxed`}><SafeInlineContent text={b.text} /></li>;
                        if (b.type === 'quote') return <blockquote key={i} className={`border-l-[6px] border-[#81a1c1] pl-8 italic ${textScale} my-8 text-[#4c566a] bg-[#f8fafc] py-6 rounded-r-2xl shadow-sm`}><SafeInlineContent text={b.text} /></blockquote>;
                        if (b.type === 'p') return <p key={i} className={`${textScale} mb-6 text-[#4c566a] leading-relaxed`}><SafeInlineContent text={b.text} /></p>;
                        if (b.type === 'image') return <div key={i} className="my-8 flex justify-center flex-1 overflow-hidden"><img src={b.url} className="max-w-full max-h-full object-contain rounded-3xl shadow-xl border border-[#d8dee9] p-1.5 bg-white" onError={(e) => e.target.src='[https://placehold.co/600x400?text=Image+Not+Found](https://placehold.co/600x400?text=Image+Not+Found)'} /></div>;
                        if (b.type === 'video') return <div key={i} className="my-8 flex justify-center flex-1 overflow-hidden aspect-video"><SmartVideoPlayer url={b.url} alt={b.alt} mini={mini} /></div>;
                        if (b.type === 'table') return (
                            <div key={i} className="my-8 overflow-x-auto rounded-2xl border border-[#d8dee9] shadow-sm bg-white">
                                <table className={`w-full border-collapse ${mini ? 'text-[4px]' : 'text-xl'}`}>
                                    <thead className="bg-[#eceff4]"><tr>{b.rows[0]?.map((c, j) => <th key={j} style={{ textAlign: b.alignments[j] || 'left' }} className="p-4 border-b-2 border-[#d8dee9] font-black text-[#2e3440] uppercase tracking-wider text-xs">{c}</th>)}</tr></thead>
                                    <tbody>{b.rows.slice(1).map((r, j) => <tr key={j} className={j % 2 === 0 ? 'bg-white' : 'bg-[#f8fafc]'}>{r.map((c, k) => <td key={k} style={{ textAlign: b.alignments[k] || 'left' }} className="p-4 border-b border-[#d8dee9] text-[#4c566a]">{c}</td>)}</tr>)}</tbody>
                                </table>
                            </div>
                        );
                        if (b.type === 'code') return <pre key={i} className={`${mini ? 'text-[3px] p-2' : 'p-6 text-sm'} bg-[#2e3440] text-[#d8dee9] rounded-2xl font-mono overflow-x-auto my-6 border border-[#4c566a] shadow-inner`}>{b.lines.join('\n')}</pre>;
                        return <div key={i} className={mini ? "h-1" : "h-4"} />;
                    })}
                </div>
            );
        });

        // --- APP ---
        const App = () => {
            const [markdown, setMarkdown] = useState(`---
title: "Quarto Card Viewer"
subtitle: "Soft Depth & Premium Design"
author: "Presenter"
---

# Elevated Presentation
## Premium Card Experience

- **Depth**: Soft-floating shadow logic
- **Geometry**: Pill-shaped corners
- **Aesthetic**: Minimalist Nord Light
- **Interaction**: Dynamic hover lift

::: notes
Notice the rounded corners and the floating effect. 
This separates the content visually from the Snow Storm background.
:::

---

## Data Visualization

| Component | Style | Feel |
|:---|:---:|:---:|
| Slide | Card | Floating |
| Tables | Rounded | Nested |
| Code | Dark | Recessed |

---

# Smart Multimedia

![video](https://www.youtube.com/embed/dQw4w9WgXcQ)

::: notes
Multimedia items are also rendered as cards with distinct borders.
:::`);

            const [currentSlide, setCurrentSlide] = useState(0);
            const [isSidebarOpen, setIsSidebarOpen] = useState(true);
            const [isFullscreen, setIsFullscreen] = useState(false);
            const [isOverviewMode, setIsOverviewMode] = useState(false);
            const [showNotes, setShowNotes] = useState(false);
            const [searchQuery, setSearchQuery] = useState('');
            const [timer, setTimer] = useState(0);
            const [isTimerRunning, setIsTimerRunning] = useState(false);
            const fileInputRef = useRef(null);

            const { metadata, slides } = useMemo(() => {
                const yamlRegex = /^---\s*[\r\n]([\s\S]*?)[\r\n]---/;
                const match = markdown.match(yamlRegex);
                const meta = {};
                let body = markdown;
                if (match) {
                    match[1].split('\n').forEach(l => {
                        const [k, ...v] = l.split(':');
                        if (k && v) meta[k.trim()] = v.join(':').trim().replace(/['"]/g, '');
                    });
                    body = markdown.replace(yamlRegex, '');
                }
                const parts = body.split(/^---$/m).map(s => s.trim()).filter(s => s.length > 0);
                return { metadata: meta, slides: parts };
            }, [markdown]);

            const filteredSlides = useMemo(() => {
                if (!searchQuery) return [];
                return slides.map((content, index) => ({ content, index }))
                             .filter(s => s.content.toLowerCase().includes(searchQuery.toLowerCase()));
            }, [searchQuery, slides]);

            const handleFileOpen = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (e) => { setMarkdown(e.target.result); setCurrentSlide(0); };
                reader.readAsText(file);
            };

            const downloadMarkdown = () => {
                const blob = new Blob([markdown], { type: 'text/markdown' });
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = `${metadata.title || 'presentation'}.qmd`;
                a.click();
            };

            const exportStandalone = () => {
                const escapedMarkdown = markdown.replace(/`/g, '\\`').replace(/\$/g, '\\$');
                const newHtml = document.documentElement.outerHTML.replace(
                    /const \[markdown, setMarkdown\] = useState\([\s\S]*?\);/, 
                    `const [markdown, setMarkdown] = useState(\`${escapedMarkdown}\`);`
                );
                const blob = new Blob([newHtml], { type: 'text/html' });
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = `deck_${metadata.title || 'presentation'}.html`;
                a.click();
            };

            useEffect(() => {
                let itv;
                if (isTimerRunning) itv = setInterval(() => setTimer(t => t + 1), 1000);
                return () => clearInterval(itv);
            }, [isTimerRunning]);

            useEffect(() => {
                const handleKey = (e) => {
                    if (['TEXTAREA', 'INPUT'].includes(document.activeElement.tagName)) return;
                    if (e.key === 'ArrowRight' || e.key === ' ') setCurrentSlide(s => Math.min(s + 1, slides.length - 1));
                    if (e.key === 'ArrowLeft') setCurrentSlide(s => Math.max(s - 1, 0));
                    if (e.key === 'Escape') { setIsFullscreen(false); setIsOverviewMode(false); setIsSidebarOpen(true); }
                    if (e.key.toLowerCase() === 'o') setIsOverviewMode(!isOverviewMode);
                    if (e.key.toLowerCase() === 's') setShowNotes(!showNotes);
                    if (e.key.toLowerCase() === 'f') { 
                        const nextState = !isFullscreen;
                        setIsFullscreen(nextState); 
                        setIsSidebarOpen(!nextState);
                        setIsTimerRunning(nextState);
                    }
                };
                window.addEventListener('keydown', handleKey);
                return () => window.removeEventListener('keydown', handleKey);
            }, [slides.length, isFullscreen, isOverviewMode, showNotes]);

            return (
                <div className="flex h-screen w-full overflow-hidden text-[#2e3440] bg-[#eceff4]">
                    {/* Sidebar */}
                    {!isFullscreen && (
                        <div className={`transition-all duration-500 bg-[#e5e9f0] border-r border-[#d8dee9] flex flex-col shadow-2xl z-20 ${isSidebarOpen ? 'w-[420px]' : 'w-0 overflow-hidden'}`}>
                            <div className="p-5 bg-[#eceff4] border-b flex justify-between items-center">
                                <div className="flex items-center gap-3 font-black text-xs text-[#4c566a] uppercase tracking-[0.2em]"><Icon name="file-text" size={20}/><span>Editor</span></div>
                                <button onClick={() => setIsSidebarOpen(false)} className="p-2 hover:bg-[#d8dee9] rounded-xl transition-all"><Icon name="panel-left-close"/></button>
                            </div>
                            
                            {/* Search */}
                            <div className="p-4 border-b bg-white/40">
                                <div className="relative group">
                                    <Icon name="search" size={14} className="absolute left-4 top-3 text-[#4c566a]" />
                                    <input 
                                        type="text" 
                                        placeholder="Search slides..." 
                                        className="w-full pl-11 pr-4 py-2 text-xs rounded-xl border border-[#d8dee9] focus:ring-2 focus:ring-[#81a1c1]/30 bg-white/80 outline-none transition-all"
                                        value={searchQuery}
                                        onChange={(e) => setSearchQuery(e.target.value)}
                                    />
                                </div>
                                {searchQuery && (
                                    <div className="mt-3 max-h-48 overflow-y-auto bg-white rounded-2xl border border-[#d8dee9] text-[10px] shadow-xl animate-in slide-in-from-top-2 duration-300">
                                        {filteredSlides.length > 0 ? filteredSlides.map(s => (
                                            <button key={s.index} onClick={() => { setCurrentSlide(s.index); setSearchQuery(''); }} className="w-full text-left p-3 hover:bg-[#eceff4] border-b last:border-0 truncate flex items-center gap-3 group">
                                                <span className="font-black text-[#81a1c1] bg-[#eceff4] w-6 h-6 flex items-center justify-center rounded-lg group-hover:bg-[#81a1c1] group-hover:text-white transition-all">{s.index + 1}</span>
                                                <span className="font-semibold text-[#4c566a]">{s.content.split('\n')[0].replace(/[#\s-]/g, '') || 'Untitled Slide'}</span>
                                            </button>
                                        )) : <div className="p-4 text-center text-[#4c566a] italic">No results matched</div>}
                                    </div>
                                )}
                            </div>

                            <div className="p-4 flex gap-3 border-b bg-white/20">
                                <button onClick={() => fileInputRef.current.click()} className="flex-1 flex items-center justify-center gap-2 py-3 text-xs font-black uppercase tracking-widest bg-[#81a1c1] text-white rounded-xl hover:bg-[#5e81ac] shadow-lg transition-all active:scale-95"><Icon name="folder-open" size={14}/> OPEN</button>
                                <button onClick={downloadMarkdown} className="flex-1 flex items-center justify-center gap-2 py-3 text-xs font-black uppercase tracking-widest border-2 border-[#81a1c1] text-[#81a1c1] rounded-xl hover:bg-[#81a1c1]/10 transition-all active:scale-95"><Icon name="save" size={14}/> SAVE</button>
                                <input type="file" ref={fileInputRef} onChange={handleFileOpen} className="hidden" accept=".md,.qmd,.txt" />
                            </div>

                            <textarea value={markdown} onChange={(e) => setMarkdown(e.target.value)} className="flex-1 p-8 font-mono text-sm resize-none outline-none bg-white text-[#2e3440] leading-loose scrollbar-hide" spellCheck="false" />
                            
                            <div className="p-5 bg-[#d8dee9]">
                                <button onClick={exportStandalone} className="w-full flex items-center justify-center gap-3 py-4 text-xs font-black uppercase tracking-[0.2em] bg-[#4c566a] text-white rounded-2xl hover:bg-[#2e3440] shadow-2xl transition-all transform active:scale-95"><Icon name="zap" size={16}/> Export Standalone</button>
                            </div>
                        </div>
                    )}

                    {/* Stage Container */}
                    <div className="flex-1 flex flex-col relative overflow-hidden transition-all">
                        {!isFullscreen && (
                            <header className="h-16 bg-white/80 backdrop-blur-md border-b border-[#d8dee9] flex items-center justify-between px-8 z-10 shadow-sm">
                                <div className="flex items-center gap-6">
                                    {!isSidebarOpen && <button onClick={() => setIsSidebarOpen(true)} className="p-2 bg-[#eceff4] hover:bg-[#d8dee9] rounded-xl transition-all shadow-sm"><Icon name="panel-left-open"/></button>}
                                    <h1 className="text-sm font-black text-[#4c566a] uppercase tracking-widest">{metadata.title || 'Presentation Draft'}</h1>
                                </div>
                                <div className="flex items-center gap-3">
                                    <button onClick={() => setShowNotes(!showNotes)} className={`p-2.5 rounded-xl transition-all shadow-sm ${showNotes ? 'bg-[#81a1c1] text-white' : 'bg-[#eceff4] hover:bg-[#d8dee9] text-[#4c566a]'}`} title="Notes (S)"><Icon name="message-square"/></button>
                                    <button onClick={() => setIsOverviewMode(!isOverviewMode)} className={`p-2.5 rounded-xl transition-all shadow-sm ${isOverviewMode ? 'bg-[#81a1c1] text-white' : 'bg-[#eceff4] hover:bg-[#d8dee9] text-[#4c566a]'}`} title="Overview (O)"><Icon name="grid"/></button>
                                    <div className="w-[1px] h-6 bg-[#d8dee9] mx-2"></div>
                                    <button onClick={() => {setIsFullscreen(true); setIsSidebarOpen(false); setIsTimerRunning(true);}} className="flex items-center gap-3 px-6 py-2.5 bg-[#81a1c1] text-white text-xs font-black uppercase tracking-[0.15em] rounded-xl shadow-[0_10px_20px_-5px_rgba(129,161,193,0.5)] hover:bg-[#5e81ac] transition-all transform active:scale-95"><Icon name="play" size={16}/> Present</button>
                                </div>
                            </header>
                        )}

                        <div className={`flex-1 flex ${isFullscreen && showNotes ? 'flex-row' : 'flex-col'} p-6 md:p-14 relative overflow-hidden bg-[#eceff4] transition-all`}>
                            {/* Slide Display or Overview */}
                            <div className="flex-1 relative flex items-center justify-center overflow-y-auto scrollbar-hide">
                                {isOverviewMode ? (
                                    <div className="w-full h-full max-w-7xl mx-auto grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-10 p-4">
                                        {slides.map((content, idx) => (
                                            <div key={idx} onClick={() => { setCurrentSlide(idx); setIsOverviewMode(false); }} className={`aspect-[16/9] bg-white border-2 rounded-[2rem] cursor-pointer transition-all hover:scale-105 hover:rotate-1 overflow-hidden relative slide-card-shadow ${currentSlide === idx ? 'border-[#81a1c1] ring-8 ring-[#81a1c1]/10' : 'border-white'}`}>
                                                <SlideRenderer content={content} isTitleSlide={idx === 0} isFullscreen={isFullscreen} mini={true} />
                                                <div className="absolute bottom-3 right-5 text-xs font-black text-white bg-[#81a1c1] px-3 py-1 rounded-full shadow-lg">{idx + 1}</div>
                                            </div>
                                        ))}
                                    </div>
                                ) : (
                                    <div className={`w-full h-full relative flex flex-col bg-white overflow-hidden transition-all duration-700 slide-card-shadow ${isFullscreen ? 'rounded-none max-w-full' : 'max-w-6xl aspect-[16/9] rounded-[3.5rem] border-[12px] border-white'}`}>
                                        
                                        {isFullscreen && (
                                            <div className="absolute top-8 right-8 opacity-0 hover:opacity-100 transition-all duration-300 z-50">
                                                <button onClick={() => setIsFullscreen(false)} className="p-4 bg-white/95 shadow-2xl rounded-full text-[#4c566a] hover:text-[#bf616a] transform hover:scale-110 active:scale-90"><Icon name="minimize" size={24}/></button>
                                            </div>
                                        )}

                                        {/* Premium Title Slide */}
                                        {currentSlide === 0 && metadata.title && !slides[0].includes(metadata.title) && (
                                            <div className="absolute inset-0 z-10 flex flex-col items-center justify-center bg-white p-20 text-center fade-in">
                                                <h1 className={`${isFullscreen ? 'text-9xl' : 'text-7xl'} font-black text-[#2e3440] mb-10 tracking-tighter leading-tight`}><SafeInlineContent text={metadata.title} /></h1>
                                                {metadata.subtitle && <h2 className="text-4xl text-[#4c566a] font-light mb-16 tracking-wide opacity-80 italic"><SafeInlineContent text={metadata.subtitle} /></h2>}
                                                <div className="w-48 h-2 bg-[#88c0d0] rounded-full shadow-sm mb-12" />
                                                {metadata.author && <p className="text-2xl text-[#81a1c1] font-black uppercase tracking-[0.3em]">{metadata.author}</p>}
                                            </div>
                                        )}
                                        
                                        <div className="flex-1 overflow-y-auto scrollbar-hide">
                                            <SlideRenderer content={slides[currentSlide] || ''} isTitleSlide={currentSlide === 0} isFullscreen={isFullscreen} />
                                        </div>
                                        
                                        {/* Styled Progress Bar */}
                                        <div className="h-2.5 bg-[#e5e9f0] w-full mt-auto relative shadow-inner overflow-hidden">
                                            <div className="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent animate-pulse"></div>
                                            <div className="h-full bg-gradient-to-r from-[#81a1c1] to-[#88c0d0] transition-all duration-700 ease-in-out shadow-[0_0_20px_rgba(129,161,193,0.6)]" style={{ width: `${((currentSlide + 1) / slides.length) * 100}%` }} />
                                        </div>

                                        {!isFullscreen && (
                                            <>
                                                <button onClick={() => setCurrentSlide(s => Math.max(s - 1, 0))} className="absolute left-8 top-1/2 -translate-y-1/2 p-5 bg-white/80 backdrop-blur-xl shadow-2xl rounded-full text-[#4c566a] hover:text-[#81a1c1] opacity-0 hover:opacity-100 transition-all transform active:scale-75 translate-x-4 hover:translate-x-0"><Icon name="chevron-left" size={28}/></button>
                                                <button onClick={() => setCurrentSlide(s => Math.min(s + 1, slides.length - 1))} className="absolute right-8 top-1/2 -translate-y-1/2 p-5 bg-white/80 backdrop-blur-xl shadow-2xl rounded-full text-[#4c566a] hover:text-[#81a1c1] opacity-0 hover:opacity-100 transition-all transform active:scale-75 -translate-x-4 hover:translate-x-0"><Icon name="chevron-right" size={28}/></button>
                                            </>
                                        )}
                                    </div>
                                )}
                            </div>

                            {/* Elevated Speaker Console */}
                            {showNotes && !isOverviewMode && (
                                <aside className={`${isFullscreen ? 'w-[480px] ml-14' : 'mt-12 h-64'} bg-[#3b4252] text-[#eceff4] rounded-[3rem] shadow-[0_30px_60px_-15px_rgba(46,52,64,0.4)] flex flex-col overflow-hidden border border-white/10 animate-in slide-in-from-bottom-6 duration-500`}>
                                    <div className="p-6 bg-[#2e3440] flex justify-between items-center shadow-lg">
                                        <div className="flex items-center gap-4 font-black text-xs tracking-[0.25em] text-[#88c0d0] uppercase"><Icon name="message-square" size={20}/> Speaker Notes</div>
                                        <div className="flex items-center gap-4 px-6 py-2 bg-[#4c566a]/50 rounded-2xl text-sm font-mono shadow-inner border border-white/5 text-[#eceff4]">
                                            <Icon name="clock" size={16} className="text-[#88c0d0]"/> <span>{Math.floor(timer/60)}:{String(timer%60).padStart(2,'0')}</span>
                                        </div>
                                    </div>
                                    <div className="flex-1 p-10 overflow-y-auto text-2xl font-light italic leading-relaxed text-[#d8dee9] border-t border-white/5 bg-gradient-to-b from-transparent to-[#2e3440]/20">
                                        {(slides[currentSlide]?.match(/::: notes\s*([\s\S]*?)\s*:::/)?.[1] || "Focus on the content and maintain engagement.").split('\n').map((l, i) => <p key={i} className="mb-6">{l}</p>)}
                                    </div>
                                </aside>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>